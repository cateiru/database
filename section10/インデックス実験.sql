--  インデックス実験

-- 10行テーブル R10作成

CREATE TABLE R10 (
    A1 INT,
	A2 INT,
	A3 INT,
	A4 VARCHAR(50)
);

INSERT INTO R10 (A1, A2, A3) VALUES
    (0,0,0), (1,1,1), (2,2,2), (3,3,3), (4,4,4),
	(5,5,5), (6,6,6), (7,7,7), (8,8,8), (9,9,9);

UPDATE R10 SET A4 = '東京電機大学東京千住キャンパス';

SELECT * FROM R10;

-- 100行テーブル R100作成

CREATE TABLE R100 AS
    SELECT L.A1+10*R.A1 AS A1, L.A2+10*R.A2 AS A2, L.A3+10*R.A3 AS A3, L.A4
	FROM R10 AS L CROSS JOIN R10 AS R;

SELECT * FROM R100;

-- 1,000行テーブル R1K作成

CREATE TABLE R1K AS
    SELECT L.A1+10*R.A1 AS A1, L.A2+10*R.A2 AS A2, L.A3+10*R.A3 AS A3, L.A4
	FROM R10 AS L CROSS JOIN R100 AS R;

CREATE INDEX R1KH ON R1K USING hash (A1);
CREATE INDEX R1KB ON R1K USING btree (A2);

SELECT * FROM R1K LIMIT 100;

-- 10,000行テーブル R10K作成

CREATE TABLE R10K AS
    SELECT L.A1+10*R.A1 AS A1, L.A2+10*R.A2 AS A2, L.A3+10*R.A3 AS A3, L.A4
	FROM R10 AS L CROSS JOIN R1K AS R;

CREATE INDEX R10KH ON R10K USING hash (A1);
CREATE INDEX R10KB ON R10K USING btree (A2);

SELECT * FROM R10K LIMIT 100;

-- 100,000行テーブル R100K作成

CREATE TABLE R100K AS
    SELECT L.A1+10*R.A1 AS A1, L.A2+10*R.A2 AS A2, L.A3+10*R.A3 AS A3, L.A4
	FROM R10 AS L CROSS JOIN R10K AS R;

CREATE INDEX R100KH ON R100K USING hash (A1);
CREATE INDEX R100KB ON R100K USING btree (A2);

SELECT * FROM R100K LIMIT 100;

-- 1,000,000行テーブル R1000K作成

CREATE TABLE R1000K AS
    SELECT L.A1+10*R.A1 AS A1, L.A2+10*R.A2 AS A2, L.A3+10*R.A3 AS A3, L.A4
	FROM R10 AS L CROSS JOIN R100K AS R;

CREATE INDEX R1000KH ON R1000K USING hash (A1);
CREATE INDEX R1000KB ON R1000K USING btree (A2);

SELECT * FROM R1000K LIMIT 100;

-- 10,000,000行テーブル R1000K作成

CREATE TABLE R10000K AS
    SELECT L.A1+10*R.A1 AS A1, L.A2+10*R.A2 AS A2, L.A3+10*R.A3 AS A3, L.A4
	FROM R10 AS L CROSS JOIN R1000K AS R;

CREATE INDEX R10000KH ON R10000K USING hash (A1);
CREATE INDEX R10000KB ON R10000K USING btree (A2);

SELECT * FROM R10000K LIMIT 100;

-- ランダムアクセス

-- ハッシュ

SELECT * FROM R1K WHERE A1 = 555;
SELECT * FROM R10K WHERE A1 = 5555;
SELECT * FROM R100K WHERE A1 = 55555;
SELECT * FROM R1000K WHERE A1 = 555555;
SELECT * FROM R10000K WHERE A1 = 5555555;

-- B-tree

SELECT * FROM R1K WHERE A2 = 555;
SELECT * FROM R10K WHERE A2 = 5555;
SELECT * FROM R100K WHERE A2 = 55555;
SELECT * FROM R1000K WHERE A2 = 555555;
SELECT * FROM R10000K WHERE A2 = 5555555;

-- インデックスなし

SELECT * FROM R1K WHERE A3 = 555;
SELECT * FROM R10K WHERE A3 = 5555;
SELECT * FROM R100K WHERE A3 = 55555;
SELECT * FROM R1000K WHERE A3 = 555555;
SELECT * FROM R10000K WHERE A3 = 5555555;

-- キー順アクセス

-- ハッシュ

SELECT * FROM R1K WHERE A1 BETWEEN 777 AND 786;
SELECT * FROM R10K WHERE A1 BETWEEN 7777 AND 7786;
SELECT * FROM R100K WHERE A1 BETWEEN 77777 AND 77786;
SELECT * FROM R1000K WHERE A1 BETWEEN 777777 AND 777786;
SELECT * FROM R10000K WHERE A1 BETWEEN 7777777 AND 7777786;

-- B-tree

SELECT * FROM R1K WHERE A2 BETWEEN 777 AND 786;
SELECT * FROM R10K WHERE A2 BETWEEN 7777 AND 7786;
SELECT * FROM R100K WHERE A2 BETWEEN 77777 AND 77786;
SELECT * FROM R1000K WHERE A2 BETWEEN 777777 AND 777786;
SELECT * FROM R10000K WHERE A2 BETWEEN 7777777 AND 7777786;

-- インデックスなし

SELECT * FROM R1K WHERE A3 BETWEEN 777 AND 786;
SELECT * FROM R10K WHERE A3 BETWEEN 7777 AND 7786;
SELECT * FROM R100K WHERE A3 BETWEEN 77777 AND 77786;
SELECT * FROM R1000K WHERE A3 BETWEEN 777777 AND 777786;
SELECT * FROM R10000K WHERE A3 BETWEEN 7777777 AND 7777786;

-- 後処理

DROP TABLE IF EXISTS R10;
DROP TABLE IF EXISTS R100;
DROP TABLE IF EXISTS R1K;
DROP TABLE IF EXISTS R10K;
DROP TABLE IF EXISTS R100K;
DROP TABLE IF EXISTS R1000K;
DROP TABLE IF EXISTS R10000K;
