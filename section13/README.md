# 13回目 情報検索システム

## 情報検索システム（Information Retrieval System）

- 大量の情報を整理して蓄積し、必要に応じて取り出すことができるシステム
- 問い合わせに対する単純なパターンマッチングではなく、適切な文章（relevant documents）を探索するシステム
- 元々は、文献、特許、法令、判例等の文章情報をキーワードによって検索するシステムから発展
- 類似
  - 索引カード
  - パンチカードシステム
  - ホールソートカード

### 情報検索システムのモデル

- キーワード検索モデル（Boolean model）
  - 文章内容を代表する複数の単語（キーワード）を事前に人で付与しておき、これを検索対象として処理
  - キーワードの語彙を限定する統制語方式と限定しない自由語方式がある。
- 全文検索モデル（Full text search model）※主流
  - 文章そのものを検索対象とし、質問文は複数の単語をANDやOR等の論理演算子で組み合わせたものを用いる
  - 検索処理を高速化するため、事前に文章を解析して単語の出現回数や位置を抽出し、索引を作成

### 情報検索システムの索引構造

- 転置ファイル（Inverted file）
  - キーワードに関する見出しとなる辞書ファイルと、各キーワードが出現する文章番号と文章内位置を保持する位置ファイルからなる
  - 転置ファイルは大きな格納領域を必要とし、一般にもとの文章サイズの50~100%の大きさになる
- シグネチャファイル（Signature file）
  - ビット列により文章内容をコンパクトに表現し、キーワードが、含まれる可能性がある文章を抽出できる。
  - 文章データが増加すると、実際には検索条件を満たない文章を選択するフォールスドロップが多発

### 全文検索モデルの実現方法

- 索引生成（情報登録時）
    1. 単語抽出（形態素解析による品詞推定）
    2. 不要単語除去（冠詞、助詞、記号等の削除）
    3. 単語変換（単数形、終止形等の基本形に変換）
    4. 単語出現頻度修正（BoW: bag-of-words）
    5. 索引作成
- 索引検索（検索実行時）
    1. 質問文に対して前処理1~3を実行
    2. 索引検索
    3. 検索結果のランク付け

### TF・IDF法

- ベクトル検索
  - 検索対象となる文章と、質問文の両方を単語のベクトルとして表現し、検索結果をベクトル間の類似度順に出力
  - 単語には以下の基準で重要度を割り当て
  - $重要度=TF \times IDF$
- TF（Term Frequency）
  - 文章中における単語の出現頻度
  - $TF=\frac{単語の出現回数}{全単語の出現回数}$
- IDF（Inverse Document Frequency）
  - 単語を含む文章数の割合の逆数
  - $IDF = 1 + \log{\frac{全文書数}{単語が出現する文書数}}$

## 情報検索システムの評価方法

> - U: 蓄積情報の全体
> - T: 検索されるべき情報
> - S: 実際に検索された情報

- 再現率
  - 検索漏れの少なさ
  - $R=|T\cap S|/|T|$
- 適合率
  - 検索ノイズの少なさ
  - $P = |T\cap S|/|S|$
- F値
  - 再現率と適合率の調和平均
  - $F=\frac{2RP}{R+P}$

### PostgreSQLの全文検索機能

- 基本機能
  - 文章からトークンを解析
  - トークンを語彙素に変換
  - 検索用に最適化済みの文章を保存
- データ型と演算子
  - tsvector: 検索対象となる文章
  - tsquery: 検索条件
  - @@: 称号演算子

### データ構造と演算子

- データ構造
  - tsvector: ベクトル形式に変換された文章
  - tsquery: 論理式に変換された問い合わせ
- 主な全文検索演算子と関数
  - @@: 文章の問い合わせを照合し、真偽を判定する
  - to_tsvector: 文章テキストをベクトル形式に変換する
  - to_tsquery: 問い合わせテキストを論理式に変換する
  - ts_rank: 文章と問い合わせの類似度を計算する
  - ts_debug: 文章の解析結果を出力する
