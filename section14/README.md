# 14回目 NoSQL

## 概要

- Non SQL, Non Relational or Not only SQL
- 広義: リレーショナルデータモデルでないデータベースシステムのこと
- 狭義: リレーショナルデータベースの限界を打破するために新しく考案されたデータベースシステム

## 初期のデータ管理システム

- フラットファイルシステム
  - 磁気テープやディスク上のファイルにデータを格納
  - 基本はシーケンシャルアクセス
- 階層型データベースシステム
  - 親子関係にあるデータを互いに連結して格納
  - 親から子へのトップダウン（一方向のアクセス）
- ネットワーク型データベースシステム
  - リンクに関する階層型制約を緩和
  - トップダウンとボトムアップの双方向アクセスが可能

## 現在のデータ管理システム

- リレーショナルデータベースシステム
  - 強固な数学基盤（関係代数・関係論理）に基づく論理的なデータ独立性を実現
  - データの定義・操作・制御を行うための標準言語SQLを提供
- ポストリレーショナルデータベースシステム
- NoSQLデータベースシステム

### リレーショナルデータベースの限界

- 拡張性
  - スケールアップ（スペックアップ）→容易
  - スケールダウン（分散化）→困難
- コスト
  - 必要なハードウェアおよびソフトウェア自体が高額
- 柔軟性
  - 多様なデータを扱うにはテーブルの構造が固すぎる
- 可用性
  - 多数のサーバを用いたクラスタ構成の実現が困難

## データベースシステムの要件

- データを永続的に格納する
  - サーバが停止してもデータが失われないこと
  - 不揮発性メディアを利用する
- データの一貫性を維持する
  - 複数ユーザの同時アクセスを可能にすること
  - トランザクションとして制御する
- データの可用性を確保する
  - サーバが停止してもデータにアクセス可能なこと
  - データを二重化してバックアップする

## 分散システムにおける一貫性と可用性

- 常時一貫性が要求される業務
  - 銀行における決済処理（入金、出金、振替など）
- 一貫性よりも即時性が要求される業務
  - ショッピングサイトにおけるカート処理

## CAP定義（ブリュワーの定理）

分散データベースにおいて、以下の3つの性質を同時に満たすことはできない。

- **C**: 一貫性（Consistency）
  - 異なるサーバにあるデータのコピーが一致していること
- **A**: 可用性（Availability）
  - 任意の問い合わせに対して常に応答が可能なこと
- **P**: 分断体制（Partition Protection）
  - サーバ間の通信が途絶してもサービスの継続が可能なこと

### ACID

リレーショナルデータベースは、ACIDトランザクションのサポートを前提に設計

- A: 原始性（Atomicity）
  - トランザクションは分割されない（中途半端に実行されない）
- C: 一貫性（Consistency）
  - トランザクションの実行結果は整合した状態に保たれる
- I: 独立性（Isolation）
  - トランザクションは他のトランザクションの影響を受けない
- D: 永続性（Durability）
  - トランザクションが実行した結果は障害によって消失しない

### BASE

NoSQLデータベースは、主にBASEトランザクションをサポートするものが多い

- BA: 基本可用性（Basically Available）
  - 一部が利用不可になっても他の部分は利用可能である
- S: 柔軟状態性（Soft State）
  - データは必要な時までに更新されれば良い
- E: 結果整合性（Eventually Consistent）
  - データのすべてのコピーは最終的には同じ値に更新される

## NoSQLデータベースのタイプ

- キー・バリュー型（Key Value Pair）
  - 単純なキーと単純なバリューの対を使用
  - もっとも単純なデータモデル
- ドキュメント型
  - 単純なキーと階層構造を持ったバリューの対を使用
  - 関連するキーを1つのドキュメントとするデータモデル
- カラムファミリー型
  - 単純キーと単純なバリューの対の集合を使用
  - 列を主体とした表に似たデータモデル
- グラフ型
  - 節（ノード）と枝（エッジ）から構成されたグラフ構造を使用
  - ネットワークの表現に適したデータモデル
